<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link rel="stylesheet" href="../bootstrap/css/bootstrap.min.css">
    <style>
        .col-md-5,
        .col-md-6 {
            border: solid;
            /* 設定底部間隔，您可以調整這個值 */
        }

        .Allcontent {
            width: 100%;
            display: flex;
            flex-direction: column;
            flex-wrap: wrap;
        }

        .Allcontent p {
            display: flex;
            width: 100%;
        }

        .Allcontent .text {
            width: 100%;
        }

        .Alltitle {
            font-size: 30px;
        }

        .navbar-brand {
            text-decoration: none;
            font-size: 30px;
        }


        /* --------------------------------------------------- */

        /* 抽籤容器 */
        .carousel-container {
            display: none;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 99999;
        }


        /* card容器 */
        .card {
            display: absolute;
            top: 5%;
            width: 80%;
            height: 90vh;
            margin-left: auto;
            margin-right: auto;
            background-color: red;
        }

        @media (min-width: 767px) {
            .card {
                width: 50%;
            }
        }

        /* 輪播容器 */
        .carousel {
            height: 85%;
            width: 100%;

            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgb(37, 81, 225);
        }

        /* 輪播圖片 */
        .carousel-inner {
            width: 100%;
            height: 70vh;
            /* overflow-y: scroll; */
        }

        .card-body {
            height: 15%;
            width: 100%;

            display: flex;
            justify-content: center;
        }

        .card-body button {
            width: 40%;
            display: flex;
            justify-content: center;
            align-items: center;

            display: inline-block;
            outline: none;

            margin-left: 10px;
            /* padding: 10px; */

            border-radius: 3px;
            border: 0;

            color: #fff;
            background: #ff5000;

            font-size: 80%;
            font-weight: 600;
            line-height: 2;

            cursor: pointer;
        }


        .content {
            position: absolute;
            top: 50%;
            left: 50%;
            height: 60vh;
            transform: translate(-50%, -50%);
            z-index: 999992;
        }
    </style>
</head>

<body>
    <script src="../bootstrap/js/popper.min.js"></script>
    <script src="../bootstrap/js/bootstrap.min.js"></script>

    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">

            <a class="navbar-brand" href="#">校區美食指南</a>

            <!-- 觸發折疊行為 目標ID"navbarSupportedContent" 預設:不展開 -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- collapse：無論任何螢幕大小，你都不會看到有選單在頂部。 nav-collapse：當螢幕變小時，選單會改為直行顯示。 -->
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="HomePage.html">首頁</a>
                    </li>

                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            基礎功能
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><button class="dropdown-item" onclick="showAll()">顯示所有店家</button></li>
                            <li><button class="dropdown-item" onclick="showNTOU(),showNTOUcount()">顯示可用海大卡店家</button>
                            </li>
                            <li><button class="dropdown-item" onclick="showCategory()">顯示餐廳品項種類 </button></li>

                        </ul>
                    </li>

                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="openCarousel()">今天想來點 ?</a>
                    </li>
                </ul>
                <a class="nav-link" href="edit.html">編輯頁面</a>

            </div>
        </div>
    </nav>
    <p id="NumberOfNTOUCard"></p>

    <div class="container">

        <div class="row">

        </div>
    </div>

    <!-- /* 輪播容器 */ -->
    <div class="carousel-container">
        <!-- /* card容器 */ -->
        <div class="card">
            <button onclick="closeCarousel()">關閉</button>
            <!-- /* 輪播容器 */ -->
            <div id="myCarousel" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner" id="dynamicCarouselInner">
                    <!-- <div class="carousel-item active">
                        <img src="../image/t.png" class="d-block w-10">
                    </div>
                    <div class="carousel-item">
                        <img src="../image/left.png" class="d-block w-10">
                    </div>
                    <div class="carousel-item">
                        <img src="../image/m.png" class="d-block w-10">
                    </div> -->
                </div>
            </div>


            <div class="card-body">
                <h5 class="card-title"></h5>
                <p class="card-text"></p>
                <button onclick="select()" class="select">按我選擇</button>
                <button onclick="restart()">重新抽籤</button>
            </div>
        </div>
    </div>


    <script>
        window.onload = function () {
            showAll();
        };
        function clearAll() {
            var parentContainer = document.querySelector(".row");
            parentContainer.innerHTML = '';

            var resultElement = document.getElementById("NumberOfNTOUCard");
            resultElement.innerHTML = '';
        }

        function showAll() {
            clearAll();

            fetch('../Model/showAllRestaurant.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json', // 請根據你的後端需要設置正確的 Content-Type
                },
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    var total = data.split("+");
                    var count = total[0];
                    var items = total[1].split("\n");

                    var parentContainer = document.querySelector(".row");

                    for (var i = 0; i < count; i++) {
                        var temp = items[i].split("|");

                        var colDiv = document.createElement("div");
                        colDiv.className = "col-12 col-md-5 mt-5 me-auto ms-auto";

                        var restaurantDiv = document.createElement("div");
                        restaurantDiv.innerHTML = `
                <h1 class="Alltitle">${temp[0] || "null"}</h1>
                <p><img src="https://lh5.googleusercontent.com/p/AF1QipNTUNHkT4TOCuG8Uc10iYlLlXtRq0EsTcER1vd0=w408-h306-k-no" width="100%"></p>
                <div class="Allcontent">
                    <p class="text">餐廳電話 : ${temp[2] || "null"}</p>
                    <p class="text">餐廳地址 : ${temp[3] || "null"}</p>
                    <p class="text">餐廳營業時間 : ${temp[4] || "null"}</p>
                    <button class="w-100 mb-2"> 
                        ${temp[1] !== " " ? `<a href="${temp[1] || "null"}" target="_blank">餐廳網站</a>` : "無連結"}

                    </button>
                </div>`;

                        colDiv.appendChild(restaurantDiv);
                        parentContainer.appendChild(colDiv);
                    }
                })
                .catch(error => {
                    console.error('There has been a problem with your fetch operation:', error);
                });
        }
        function showNTOU() {
            clearAll();

            fetch('../Model/showNCRestaurant.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json', // 請根據你的後端需要設置正確的 Content-Type
                },
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    var total = data.split("+");
                    var count = total[0];
                    var items = total[1].split("\n");
                    var parentContainer = document.querySelector(".row");

                    for (var i = 0; i < count; i++) {
                        var temp = items[i].split("|");

                        var colDiv = document.createElement("div");
                        colDiv.className = "col-12 col-md-5 mt-5 me-auto ms-auto";

                        var restaurantDiv = document.createElement("div");
                        restaurantDiv.innerHTML = `
                        <h1 class="Alltitle">${temp[0] || "null"}</h1>
                        <p><img src="https://lh5.googleusercontent.com/p/AF1QipNTUNHkT4TOCuG8Uc10iYlLlXtRq0EsTcER1vd0=w408-h306-k-no" width="100%"></p>
                        <div class="Allcontent">
                            <p class="text">餐廳電話 : ${temp[2] || "null"}</p>
                            <p class="text">餐廳地址 : ${temp[3] || "null"}</p>
                            <p class="text">餐廳營業時間 : ${temp[4] || "null"}</p>
                            <button class="w-100 mb-2"> 
                                ${temp[1] !== " " ? `<a href="${temp[1] || "null"}" target="_blank">餐廳網站</a>` : "無連結"}
                            </button>
                        </div>`;

                        colDiv.appendChild(restaurantDiv);
                        parentContainer.appendChild(colDiv);
                    }
                })
                .catch(error => {
                    console.error('There has been a problem with your fetch operation:', error);
                });
        }
        function showNTOUcount() {
            fetch("../Model/countNTOUCard.php")
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    var resultElement = document.getElementById("NumberOfNTOUCard");
                    resultElement.innerHTML = "能使用海大卡的店家個數: " + data;
                })
                .catch(error => {
                    console.error('There has been a problem with your fetch operation:', error);
                });
        }

        function showCategory() {
            clearAll();

            fetch('../Model/showAllRestaurantKind.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    var total = data.split("+");
                    var count = total[0];
                    var items = total[1].split("\n");
                    var parentContainer = document.querySelector(".row");

                    for (var i = 0; i < count; i++) {
                        var temp = items[i].split("|");

                        var colDiv = document.createElement("div");
                        colDiv.className = "col-12 col-md-6 mt-5 me-auto ms-auto";

                        var restaurantDiv = document.createElement("div");
                        restaurantDiv.innerHTML = `
                <h1 class="Alltitle">${temp[0] || "null"}</h1>
                <p class="text" style="display: inline-block;">餐廳總類&nbsp;</p><p style="display: inline-block;">${temp[1] || "null"}</p>`;

                        // 使用 for 迴圈，避免無窮迴圈
                        for (var j = i + 1; j < count; j++) {
                            var next = items[j].split("|");
                            if (next[0] == temp[0] && next[0] != " ") {
                                // 使用 inline-block，確保不換行
                                restaurantDiv.innerHTML += `<p class="text"  style="display: inline-block;"></p><p style="display: inline-block;">${next[1] || "null"},</p>`;
                                i = j; // 更新 i 到最後一個相同類別的項目，以避免重複處理
                            } else {
                                break;
                            }
                        }

                        restaurantDiv.innerHTML += `

                    <p class="text">餐廳地址${temp[2] || "null"}</p>`;

                        colDiv.appendChild(restaurantDiv);
                        parentContainer.appendChild(colDiv);
                    }
                })
                .catch(error => {
                    console.error('There has been a problem with your fetch operation:', error);
                });
        }



        //////////////////////////////////////////////////////////////////
        // 取得輪播容器元素
        var carousel = document.getElementById('myCarousel');
        var myCarousel = new bootstrap.Carousel(carousel, {
            interval: 100,
            pause: false
        })

        function select() {

            setTimeout(function () {
                myCarousel.pause();
            }, 100);

        }

        function restart() {
            myCarousel.cycle();

        }

        function openCarousel() {
            document.querySelector('.carousel-container').style.display = 'block';
        }

        function closeCarousel() {
            document.querySelector('.carousel-container').style.display = 'none';
        }



        fetch('../Model/showAllRestaurant.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.text();
            })
            .then(data => {
                var total = data.split("+");
                var count = total[0];
                var items = total[1].split("\n");

                var carouselInner = document.getElementById("dynamicCarouselInner");

                for (var i = 0; i < count; i++) {
                    var temp = items[i].split("|");

                    var colDiv = document.createElement("div");
                    colDiv.className = "card col-12 col-md-5 me-auto ms-auto";

                    var restaurantDiv = document.createElement("div");
                    // <p><img src="https://lh5.googleusercontent.com/p/AF1QipNTUNHkT4TOCuG8Uc10iYlLlXtRq0EsTcER1vd0=w408-h306-k-no" width="100%"></p>

                    restaurantDiv.innerHTML = `
                    <h1 class="Alltitle">${temp[0] || "null"}</h1>
                    <p><img src="${temp[5] || "null"}" width="100%"></p>
                    <div class="Allcontent">
                    <p class="text">餐廳電話 : ${temp[2] || "null"}</p>
                    <p class="text">餐廳地址 : ${temp[3] || "null"}</p>
                    <p class="text">餐廳營業時間 : ${temp[4] || "null"}</p>
                    <button class="w-100 mb-2"> 
                        ${temp[1] !== " " ? `<a href="${temp[1] || "null"}" target="_blank">餐廳網站</a>` : "無連結"}
                    </button>
                    </div>`;

                    var carouselItem = document.createElement("div");
                    carouselItem.classList.add("carousel-item");
                    carouselItem.setAttribute("data-bs-interval", "100");

                    colDiv.appendChild(restaurantDiv);
                    carouselItem.appendChild(colDiv);
                    carouselInner.appendChild(carouselItem);

                }

                carouselItem.classList.add("active");
            })
            .catch(error => {
                console.error('There has been a problem with your fetch operation:', error);
            });
    </script>
</body>

</html>