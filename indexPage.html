<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <style>
        .col-md-5 ,
        .col-md-6{
            border: solid;
            /* 設定底部間隔，您可以調整這個值 */
        }

        .Allcontent {
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            /* border: solid; */
        }

        .Allcontent p {
            display: flex;
            width: 70%;
            overflow: hidden;
            /* border: solid; */

        }

        .Allcontent .text {
            width: 30%;
            /* border: solid; */
        }

        .Alltitle {
            font-size: 30px;
        }

        .navbar-brand {
            text-decoration: none;
            font-size: 30px;
        }

    </style>
</head>

<body>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">

            <a class="navbar-brand" href="#">校區美食指南</a>

            <!-- 觸發折疊行為 目標ID"navbarSupportedContent" 預設:不展開 -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- collapse：無論任何螢幕大小，你都不會看到有選單在頂部。 nav-collapse：當螢幕變小時，選單會改為直行顯示。 -->
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#">首頁</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#"></a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            基礎功能
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><button class="dropdown-item" onclick="showAll()">顯示所有店家</button></li>
                            <li><button class="dropdown-item" onclick="showNTOU(),showNTOUcount()">顯示可用海大卡店家</button>
                            </li>
                            <li><button class="dropdown-item" onclick="showCategory()">顯示餐廳品項種類 </button></li>

                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <p id="NumberOfNTOUCard"></p>

    <div class="container">
            
            <div class="row">

        </div>
    </div>


    <script>
        window.onload = function () {
            showAll();
        };
        function clearAll() {
            var parentContainer = document.querySelector(".row");
            parentContainer.innerHTML = '';

            var resultElement = document.getElementById("NumberOfNTOUCard");
            resultElement.innerHTML = '';
        }

        function showAll() {
            clearAll();

            fetch('showAllRestaurant.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json', // 請根據你的後端需要設置正確的 Content-Type
                },
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    var total = data.split("+");
                    var count = total[0];
                    var items = total[1].split("\n");

                    var parentContainer = document.querySelector(".row");

                    for (var i = 0; i < count; i++) {
                        var temp = items[i].split("|");

                        var colDiv = document.createElement("div");
                        colDiv.className = "col-12 col-md-5 mt-5 me-auto ms-auto";

                        var restaurantDiv = document.createElement("div");
                        restaurantDiv.innerHTML = `
                <h1 class="Alltitle">${temp[0] || "null"}</h1>
                <p><img src="https://lh5.googleusercontent.com/p/AF1QipNTUNHkT4TOCuG8Uc10iYlLlXtRq0EsTcER1vd0=w408-h306-k-no" width="100%"></p>
                <div class="Allcontent">
                    <p class="text">餐廳電話</p><p>${temp[2] || "null"}</p>
                    <p class="text">餐廳地址</p><p>${temp[3] || "null"}</p>
                    <p class="text">餐廳營業時間</p><p>${temp[4] || "null"}</p>
                    <button class="w-100 mb-2"> 
                        ${temp[1] !== " " ? `<a href="${temp[1] || "null"}" target="_blank">餐廳網站</a>` : "無連結"}

                    </button>
                </div>`;

                        colDiv.appendChild(restaurantDiv);
                        parentContainer.appendChild(colDiv);
                    }
                })
                .catch(error => {
                    console.error('There has been a problem with your fetch operation:', error);
                });
        }
        function showNTOU() {
            clearAll();

            fetch('showNCRestaurant.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json', // 請根據你的後端需要設置正確的 Content-Type
                },
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    var total = data.split("+");
                    var count = total[0];
                    var items = total[1].split("\n");
                    var parentContainer = document.querySelector(".row");

                    for (var i = 0; i < count; i++) {
                        var temp = items[i].split("|");

                        var colDiv = document.createElement("div");
                        colDiv.className = "col-12 col-md-5 mt-5 me-auto ms-auto";

                        var restaurantDiv = document.createElement("div");
                        restaurantDiv.innerHTML = `
                        <h1 class="Alltitle">${temp[0] || "null"}</h1>
                        <p><img src="https://lh5.googleusercontent.com/p/AF1QipNTUNHkT4TOCuG8Uc10iYlLlXtRq0EsTcER1vd0=w408-h306-k-no" width="100%"></p>
                        <div class="Allcontent">
                            <p class="text">餐廳電話</p><p>${temp[2] || "null"}</p>
                            <p class="text">餐廳地址</p><p>${temp[3] || "null"}</p>
                            <p class="text">餐廳營業時間</p><p>${temp[4] || "null"}</p>
                            <button class="w-100 mb-2"> 
                                ${temp[1] !== " " ? `<a href="${temp[1] || "null"}" target="_blank">餐廳網站</a>` : "無連結"}
                            </button>
                        </div>`;

                        colDiv.appendChild(restaurantDiv);
                        parentContainer.appendChild(colDiv);
                    }
                })
                .catch(error => {
                    console.error('There has been a problem with your fetch operation:', error);
                });
        }
        function showNTOUcount() {
            fetch("countNTOUCard.php")
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.text();
                })
                .then(data => {
                    var resultElement = document.getElementById("NumberOfNTOUCard");
                    resultElement.innerHTML = "能使用海大卡的店家個數: " + data;
                })
                .catch(error => {
                    console.error('There has been a problem with your fetch operation:', error);
                });
        }

        function showCategory(){
            clearAll();

            fetch('showAllRestaurantKind.php', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
    },
})
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.text();
    })
    .then(data => {
        var total = data.split("+");
        var count = total[0];
        var items = total[1].split("\n");
        var parentContainer = document.querySelector(".row");

        for (var i = 0; i < count; i++) {
            var temp = items[i].split("|");

            var colDiv = document.createElement("div");
            colDiv.className = "col-12 col-md-6 mt-5 me-auto ms-auto";

            var restaurantDiv = document.createElement("div");
            restaurantDiv.innerHTML = `
                <h1 class="Alltitle">${temp[0] || "null"}</h1>
                <p class="text" style="display: inline-block;">餐廳總類&nbsp;</p><p style="display: inline-block;">${temp[1] || "null"}</p>`;
            
            // 使用 for 迴圈，避免無窮迴圈
            for (var j = i + 1; j < count; j++) {
                var next = items[j].split("|");
                if (next[0] == temp[0] && next[0] != " ") {
                    // 使用 inline-block，確保不換行
                    restaurantDiv.innerHTML += `<p class="text"  style="display: inline-block;"></p><p style="display: inline-block;">${next[1] || "null"},</p>`;
                    i = j; // 更新 i 到最後一個相同類別的項目，以避免重複處理
                } else {
                    break;
                }
            }

            restaurantDiv.innerHTML += `

                    <p class="text">餐廳地址${temp[2] || "null"}</p>`;

            colDiv.appendChild(restaurantDiv);
            parentContainer.appendChild(colDiv);
        }
    })
    .catch(error => {
        console.error('There has been a problem with your fetch operation:', error);
    });
        }


    </script>
</body>

</html>